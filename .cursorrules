# Hushh Project - AI Assistant Rules

## CRITICAL: Tri-Flow Architecture (Capacitor)

This is a Capacitor app that runs on Web, iOS, and Android.
**Native platforms have NO Next.js server at runtime.**

### BANNED PATTERNS

❌ NEVER write `fetch("/api/...")` in:
- Components (`app/**/*.tsx`, `components/**/*.tsx`)
- Pages (`app/**/page.tsx`)

Exception: Only API routes themselves (`app/api/**/route.ts`) can use fetch().

### REQUIRED PATTERNS

✅ ALWAYS use service layer:
```typescript
// In components
import { ApiService } from '@/lib/services/api-service';
const response = await ApiService.method();
```

### NEW FEATURE CHECKLIST

When creating any feature that accesses data:

1. **Backend** → Create Python endpoint in `consent-protocol/api/routes/`
2. **Web Proxy** → Create Next.js route in `hushh-webapp/app/api/`
3. **iOS Plugin** → Add Swift method in `ios/App/App/Plugins/`
4. **Android Plugin** → Add Kotlin method in `android/.../plugins/`
5. **Service** → Create platform detector in `lib/services/`
6. **Component** → Use service method (NOT fetch)

ALL 6 must exist or feature is incomplete.

### BEFORE SUGGESTING CODE

1. Check if service method exists
2. If not, flag that all 3 platform implementations are needed
3. Never suggest `fetch()` in components
4. Always suggest service-layer pattern

### COMMON MISTAKES TO AVOID

- Assuming Next.js server exists at runtime (it doesn't on native)
- Forgetting native plugins when creating API routes
- Using fetch() directly in React components
- Not checking platform in service methods

### DOCUMENTATION REFERENCES

- Tri-flow rules: `docs/project_context_map.md`
- Feature checklist: `docs/guides/feature_checklist.md`
- Route contracts: `docs/reference/route_contracts.md`
- Component guidelines: `hushh-webapp/components/README.md`

## ENFORCEMENT

ESLint will catch `fetch()` violations in components automatically.
Always run `npm run lint` before committing.

## Branching Convention

**REQUIRED FORMAT:** `/[username]/[type]/[type-name]`

- `[username]` - GitHub username (lowercase, no spaces)
- `[type]` - One of: `feat`, `fix`, `docs`, `refactor`, `test`, `chore`
- `[type-name]` - Descriptive name (kebab-case)

Examples:
- ✅ `john/feat/add-movie-agent`
- ✅ `jane/fix/vault-unlock-race-condition`
- ✅ `alice/docs/update-readme`
- ❌ `feat/add-movie-agent` (missing username)
- ❌ `john/add-movie-agent` (missing type)

**Enforcement:**
- Always suggest branch names in the `/[username]/[type]/[type-name]` format
- Never suggest branches starting with `feat/`, `fix/`, or `docs/` without username prefix
- When user asks to create a branch, prompt for their GitHub username if not provided

## Documentation Assumptions

**CRITICAL:** AI agents must verify assumptions before treating them as fact.

### Verified Information
- Contact email: `eng@hush1one.com` (all contact emails)
- Database: Supabase REST API (not Cloud SQL)
- Branch format: `/[username]/[type]/[type-name]`

### Common Assumptions to Flag
- **Email addresses**: All contact emails should be `eng@hush1one.com` (not `@hushh.ai`)
- **URLs**: External API URLs (`api.hushh.ai`, `docs.hushh.ai`) should reference local documentation paths
- **GCP Projects**: Never reference internal GCP project IDs (`hushh-pda`) - use placeholders
- **Database**: Use Supabase REST API, not Cloud SQL connection strings
- **Branch names**: Always use `/[username]/[type]/[type-name]` format

### Before Using Information
1. Check if value is a placeholder or example
2. Verify against `docs/assumptions_audit.md` if it exists
3. Flag assumptions with `<!-- ASSUMPTION: [description] -->` comments when uncertain
4. Prefer local documentation references over external URLs

# Hushh Project - AI Assistant Rules

## CRITICAL: Tri-Flow Architecture (Capacitor)

This is a Capacitor app that runs on Web, iOS, and Android.
**Native platforms have NO Next.js server at runtime.**

### BANNED PATTERNS

❌ NEVER write `fetch("/api/...")` in:
- Components (`app/**/*.tsx`, `components/**/*.tsx`)
- Pages (`app/**/page.tsx`)

Exception: Only API routes themselves (`app/api/**/route.ts`) can use fetch().

### REQUIRED PATTERNS

✅ ALWAYS use service layer:
```typescript
// In components
import { ApiService } from '@/lib/services/api-service';
const response = await ApiService.method();
```

### NEW FEATURE CHECKLIST

When creating any feature that accesses data:

1. **Backend** → Create Python endpoint in `consent-protocol/api/routes/`
2. **Web Proxy** → Create Next.js route in `hushh-webapp/app/api/`
3. **iOS Plugin** → Add Swift method in `ios/App/App/Plugins/`
4. **Android Plugin** → Add Kotlin method in `android/.../plugins/`
5. **Service** → Create platform detector in `lib/services/`
6. **Component** → Use service method (NOT fetch)

ALL 6 must exist or feature is incomplete.

### BEFORE SUGGESTING CODE

1. Check if service method exists
2. If not, flag that all 3 platform implementations are needed
3. Never suggest `fetch()` in components
4. Always suggest service-layer pattern

### COMMON MISTAKES TO AVOID

- Assuming Next.js server exists at runtime (it doesn't on native)
- Forgetting native plugins when creating API routes
- Using fetch() directly in React components
- Not checking platform in service methods

### DOCUMENTATION REFERENCES

- Tri-flow rules: `docs/project_context_map.md`
- Feature checklist: `docs/guides/feature_checklist.md`
- Route contracts: `docs/reference/route_contracts.md`
- Component guidelines: `hushh-webapp/components/README.md`

## ENFORCEMENT

ESLint will catch `fetch()` violations in components automatically.
Always run `npm run lint` before committing.

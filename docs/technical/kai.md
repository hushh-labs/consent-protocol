# Agent Kai: Deep Fundamental Analysis

> Comprehensive auditing and visualization of corporate fundamentals.
> Updated: January 2026.

---

## ðŸŽ¯ Overview

Agent Kai transforms from a basic data fetcher into a **Senior Quant Analyst**. It performs deep-dive audits on companies using SEC filings, market data, and qualitative analysis, presenting findings in a "Premium Institutional Terminal" interface.

## ðŸ“Š Key Features

### 1. Context-Aware Personalization (NEW)

Kai now integrates with the **Hushh Investor Profile**.

- **Local Decryption**: The frontend decrypts the user's risk tolerance, investment style, and existing holdings locally.
- **Injected Context**: This context is passed to the analysis engine, allowing for personalized "Bull/Bear" cases. (e.g., "Given your Conservative profile, this high Beta stock poses a resilience risk.")

### 2. Deep Fundamental Report

A structured, multi-section analysis generated by a specialized Multi-Agent Orchestrator:

- **Business Moat & Competitive Depth**: Analysis of sustainable competitive advantages.
- **Financial Resilience**: Stress-testing balance sheets against market volatility.
- **Capital Allocation**: Evaluating management's efficiency in deploying capital (ROIC, R&D).
- **Institutional Bull/Bear Cases**: Balanced, high-level arguments for and against the stock.

### 3. Advanced Visualizations

Interactive, multi-series charts powered by `recharts`:

- **Performance Trend**: Revenue vs. Operating Cash Flow (OCF) over time.
- **Growth & Innovation**: Revenue vs. R&D Spend to measure innovation efficiency.
- **Earnings Quality**: Net Income vs. OCF divergence check (Red flag detection).

### 4. Institutional Terminal UI

A premium, data-dense interface built with **Morphy-UX**:

- **Glassmorphism & Neomorphism**: Modern, depth-based UI elements.
- **GSAP Animations**: Smooth, cinematic entry animations for data cards.
- **Interactive Command Center**: Quick-scan interface for rapid ticker analysis.

---

## ðŸ—ï¸ Architecture

### AI Orchestrator (`hushh_mcp/agents/kai/orchestrator.py`)

Kai uses a **Debate Engine** approach where three specialists argue the case:

1. **Fundamental Agent**: Deep dives into SEC filings and financial ratios.
2. **Sentiment Agent**: Analyzes market narrative and catalyst flows.
3. **Valuation Agent**: Model building (DCF, Comps) and price target derivation.

The specialists reach a **Consensus** or document **Dissenting Opinions**, which are returned to the user via the `DecisionCard`.

### Backend Components

- **`FundamentalAgent`**: Orchestrates data fetching.
  - Fetches **Extended SEC Metrics**: OCF, Capex, Long-Term Debt, Equity, R&D.
  - Calculates **Deep Quant Metrics**: FCF Margin, Debt-to-Equity, Earnings Quality Ratio.
- **`DecisionGenerator`**: Synthesizes structured `DecisionCard`.
  - Promotes `quant_metrics` to top-level for frontend access.
  - Merges AI qualitative insights with deterministic financial data.

### Frontend (`app/dashboard/kai/analysis`)

- **`page.tsx`**: Main controller.
  - Manages `loading` states with `Loader2` spinner.
  - Restores and renders all key charts.
  - Retrieves `vaultOwnerToken` from `useVault()` for session-safe data access.

---

## ðŸ” Consent & Security

Kai strictly adheres to the **Hushh Consent Protocol**:

- **Hierarchical Access**: Uses the `vault.owner` scope, which satisfies all downstream `agent.kai.analyze` requirements via hierarchical validation in `token.py`.
- **Zero-Knowledge**: Personal holdings and profiles are only ever decrypted in the client's memory.

---

## ðŸš€ Usage

### Running Analysis

1. Navigate to `/dashboard/kai/analysis`.
2. Enter a ticker (e.g., "AAPL", "NVDA").
3. Click "ANALYZE".
4. View the generated **Deep Fundamental Report**.

### Key Metrics Explained

- **Earnings Quality Ratio**: `OCF / Net Income`. >1.0 indicates high quality earnings backed by cash. <1.0 suggests accounting maneuvering.
- **Innovation Efficiency**: Revenue growth relative to R&D spend.

---

## ðŸ”’ Deployment

- **Backend Service**: `consent-protocol` on Cloud Run.
- **Data Sources**: SEC EDGAR (primary), yfinance (market data).

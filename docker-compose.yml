# ==============================================================================
# Hushh Research - Docker Compose for Local Development
# ==============================================================================
#
# Usage:
#   docker-compose up --build       # Start both services
#   docker-compose up -d            # Start in background
#   docker-compose logs -f          # View logs
#   docker-compose down             # Stop services
#
# This creates a bridge network so frontend and backend can communicate
# using their service names (frontend, backend) as hostnames.
#
# ==============================================================================

version: "3.8"

services:
  # ==========================================================================
  # Frontend - Next.js (hushh-webapp)
  # ==========================================================================
  frontend:
    build:
      context: ./hushh-webapp
      dockerfile: Dockerfile
    ports:
      - "3000:3000"
    environment:
      # Backend URL for server-side API calls (uses Docker network)
      - BACKEND_URL=http://backend:8000
      # Public backend URL for browser (uses localhost since browser is outside Docker)
      - NEXT_PUBLIC_BACKEND_URL=http://localhost:8000
      - NODE_ENV=development
    depends_on:
      - backend
    volumes:
      # Mount source for hot reload (optional, remove for production-like testing)
      - ./hushh-webapp:/app
      - /app/node_modules
      - /app/.next

  # ==========================================================================
  # Backend - Python FastAPI (consent-protocol)
  # ==========================================================================
  backend:
    build:
      context: ./consent-protocol
      dockerfile: Dockerfile
    ports:
      - "8000:8000"
    environment:
      # Frontend URL for CORS
      - FRONTEND_URL=http://localhost:3000
      # Root path for Swagger (empty for local dev)
      - ROOT_PATH=
    volumes:
      # Mount source for hot reload
      - ./consent-protocol:/app

# ==============================================================================
# Network Configuration
# ==============================================================================
networks:
  default:
    driver: bridge
    # Services can reach each other via:
    # - frontend → http://backend:8000
    # - backend  → http://frontend:3000
